# 总体说明

## SCADA功能说明

`SCADA(Supervisory Control and Data Acquisition)`系统的基础功能可分为数据采集服务(`ACQ_SERVER`)
、数据监视服务(`MONI_SERVER`)、控制操作服务(`CTRL_SERVER`)、专用计算服务(`CALC_SERVER`)、应用告警服务(`ALM_SERVER`)
、数据查询服务(`DATA_SERVER`)六大部分。

各个服务的分工原则如下：

### 数据采集服务

数据处理服务的功能是将`FE`子系统的采集数据(生数据)获取至`SCADA`
数据库中，并处理为熟数据以供后续程序使用。处理的范围包括模拟量、状态量、累计量和`SOE`。详见[**数据采集服务**](acq-server.md)
页面。

### 数据监视服务

数据监视服务功能范围较广，主要功能为定期运行或触发式运行的监视功能，例如：

- 监盘操作；
- 一次设备监视；
- 二次设备监视；
- 拓扑着色；
- 光字牌监视；
  有一些监视功能是由界面程序通过网络总线发来请求触发，例如监盘操作中的挂牌、置数等等。详见[**数据监视服务
  **](moni-server.md)页面。

### 控制操作服务

控制操作服务是为`SCADA`程序提供设备远程操作的功能，包括：

- 一次设备控制操作；
- 二次设备控制操作；
- 辅助设备控制操作；
- 联动控制操作；

### 专用计算服务

专用计算服务有别于通用计算服务，是带有应用业务逻辑的计算服务，功能包括光字牌计算、总加计算、事故总计算、新能源各类指标计算等。

### 应用告警服务

处理`SCADA`各程序发送的告警事件存入数据库，并根据配置提供音响、推画面、语音、短信等功能。

## 架构设计

`SCADA`与其他`CBB`的依赖调用关系如下图所示：

![servers.png](servers.png)

- 与平台`CBB`的交互通过`dll`调用方式来实现；
- 与`SCADA`数据库之间的交互通过数据总线来完成；
- 与`FE CBB`之间的交互通过数据总线、消息总线方式来完成；

除开`SCADA`数据库(`scadamdl/alarmmdl/calmdl`)以及平台运行必需的数据库，其余交互均通过网络方式实现，架构上不允许有数据库本地部署依赖。
`SCADA`中采集->监视->告警的架构设计图如下：

![acq-moni-alm.png](acq-moni-alm.png)

`SCADA`公共动态库的架构设计图如下：
> 公共动态库指所有SCADA程序(后台、界面)可以调用的公用功能动态库。

![scada_libs.png](scada_libs.png)

| lib名称             | 作用                                              | 依赖                |
|-------------------|-------------------------------------------------|-------------------|
| `lib_scada_base`  | 提供公用的数据库连接指针，权限校验，SCADA事件ID定义，SCADA事件消息体定义等通用功能 |                   |
| `lib_scada_opr`   | 提供操作类(不包括遥控)的接口，主要用于界面操作，也可以用于后台程序              | `lib_scada_base`  |
| `lib_scada_top`   | 提供拓扑接口，同样适用于界面或后台                               | `lib_scada_base`  |
| `lib_scada_check` | 提供控制闭锁相关的接口                                     | `lib_scada_top`   |
| `lib_scada_ctrl`  | 提供控制相关的接口                                       | `lib_scada_check` |
| `lib_scada_data`  | 提供数据查询的接口，例如辅控插件所需的数据                           | `lib_scada_base`  |

### lib接口原则

公共动态库提供出来的功能接口有多种：

- 为服务程序提供的接口

  服务程序一般与数据库部署在同一个节点，为服务程序提供的接口允许使用紧耦合方式访问数据库；
- 为界面提供的接口

  界面程序有可能在任意节点被启用，所以为界面提供的接口只能使用网络方式访问数据库；
  考虑到界面的使用友好性，推荐使用异步方式（即消息总线）提供功能接口。在已经提供异步接口的前提下，可以再封装一层同步接口；

### gui程序编写原则

工具类的gui程序如维护工具、配置工具不考虑B端移植，正常使用网络方式访问数据库或调用公用lib等方式来编写即可。

界面插件类的gui程序，如厂站图右键菜单的弹出界面、辅控插件、遥控对话框等等，需要考虑B端的移植需求，不允许在界面程序中包含业务逻辑，只能通过调用公用动态库的方式来实现界面逻辑。

#### mmi工具右键菜单机制

SCADA提供一个`lib_scada_mmi_plugin`动态库做为与平台的图形展示工具的右键菜单扩展插件，其工作流程图如下：

![mmi_plugin.png](mmi_plugin.png)

